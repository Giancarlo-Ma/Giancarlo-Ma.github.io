<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Exercise 1: Bit OperationsFor this exercise, you will complete bit_ops.c by implementing the following three bit manipulation functions. You will want to use bitwise operations such as and (&amp;), or">
<meta property="og:type" content="article">
<meta property="og:title" content="cs61c-lab02">
<meta property="og:url" content="http://yoursite.com/2018/10/12/cs61c-lab02/index.html">
<meta property="og:site_name" content="Giancarlo&#39;s Blog">
<meta property="og:description" content="Exercise 1: Bit OperationsFor this exercise, you will complete bit_ops.c by implementing the following three bit manipulation functions. You will want to use bitwise operations such as and (&amp;), or">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://yoursite.com/2018/10/12/cs61c-lab02/LFSR-F16.gif">
<meta property="article:published_time" content="2018-10-12T09:10:06.000Z">
<meta property="article:modified_time" content="2020-06-07T02:09:33.800Z">
<meta property="article:author" content="Guohang Ma">
<meta property="article:tag" content="Machine Structure">
<meta property="article:tag" content="C">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/2018/10/12/cs61c-lab02/LFSR-F16.gif">

<link rel="canonical" href="http://yoursite.com/2018/10/12/cs61c-lab02/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>cs61c-lab02 | Giancarlo's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Giancarlo's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Code Life</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/12/cs61c-lab02/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Guohang Ma">
      <meta itemprop="description" content="developer blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Giancarlo's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          cs61c-lab02
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-10-12 17:10:06" itemprop="dateCreated datePublished" datetime="2018-10-12T17:10:06+08:00">2018-10-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-06-07 10:09:33" itemprop="dateModified" datetime="2020-06-07T10:09:33+08:00">2020-06-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CS61C/" itemprop="url" rel="index"><span itemprop="name">CS61C</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="Exercise-1-Bit-Operations"><a href="#Exercise-1-Bit-Operations" class="headerlink" title="Exercise 1: Bit Operations"></a>Exercise 1: Bit Operations</h1><p>For this exercise, you will complete <code>bit_ops.c</code> by implementing the following three bit manipulation functions. You will want to use bitwise operations such as and (&amp;), or (|), xor (^), not (~), left shifts (&lt;&lt;), and right shifts (&gt;&gt;). Avoid using any loops or conditional statements.</p>
<a id="more"></a>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Return the nth bit of x.</span></span><br><span class="line"><span class="comment">// Assume 0 &lt;= n &lt;= 31</span></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="title">get_bit</span><span class="params">(<span class="keyword">unsigned</span> x,</span></span></span><br><span class="line"><span class="function"><span class="params">                 <span class="keyword">unsigned</span> n)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Set the nth bit of the value of x to v.</span></span><br><span class="line"><span class="comment">// Assume 0 &lt;= n &lt;= 31, and v is 0 or 1</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">set_bit</span><span class="params">(<span class="keyword">unsigned</span> * x,</span></span></span><br><span class="line"><span class="function"><span class="params">             <span class="keyword">unsigned</span> n,</span></span></span><br><span class="line"><span class="function"><span class="params">             <span class="keyword">unsigned</span> v)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Flip the nth bit of the value of x.</span></span><br><span class="line"><span class="comment">// Assume 0 &lt;= n &lt;= 31</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">flip_bit</span><span class="params">(<span class="keyword">unsigned</span> * x,</span></span></span><br><span class="line"><span class="function"><span class="params">              <span class="keyword">unsigned</span> n)</span></span>;</span><br></pre></td></tr></table></figure>
<p>Once you complete these functions, you can compile and run your code using the following commands.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ make bit_ops</span><br><span class="line">$ .&#x2F;bit_ops</span><br></pre></td></tr></table></figure>
<p>This will print out the result of a few limited tests.</p>
<p>Checkoff [1/3]</p>
<ul>
<li>Show how you implemented get, set, and flip.</li>
<li>Show the output of running the tests.</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Return the nth bit of x.</span></span><br><span class="line"><span class="comment">// Assume 0 &lt;= n &lt;= 31</span></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="title">get_bit</span><span class="params">(<span class="keyword">unsigned</span> x,</span></span></span><br><span class="line"><span class="function"><span class="params">                 <span class="keyword">unsigned</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// YOUR CODE HERE</span></span><br><span class="line">    <span class="comment">// Returning -1 is a placeholder (it makes</span></span><br><span class="line">    <span class="comment">// no sense, because get_bit only returns</span></span><br><span class="line">    <span class="comment">// 0 or 1)</span></span><br><span class="line">    <span class="keyword">return</span> (x &gt;&gt; n) &amp; <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Set the nth bit of the value of x to v.</span></span><br><span class="line"><span class="comment">// Assume 0 &lt;= n &lt;= 31, and v is 0 or 1</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">set_bit</span><span class="params">(<span class="keyword">unsigned</span> * x,</span></span></span><br><span class="line"><span class="function"><span class="params">             <span class="keyword">unsigned</span> n,</span></span></span><br><span class="line"><span class="function"><span class="params">             <span class="keyword">unsigned</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// YOUR CODE HERE</span></span><br><span class="line">    <span class="keyword">int</span> mask = <span class="number">1</span> &lt;&lt; n;</span><br><span class="line">    (v == <span class="number">1</span>) ? (*x) |= mask : ((*x) &amp;= (~mask));</span><br><span class="line">    <span class="comment">// Or (* x) = ((* x) &amp; (0xFFFFFFFF - (1 &lt;&lt; n))) + (v &lt;&lt; n);</span></span><br><span class="line">    <span class="comment">// Make that bit to be manipulated to zero, then plus the v bit.</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Flip the nth bit of the value of x.</span></span><br><span class="line"><span class="comment">// Assume 0 &lt;= n &lt;= 31</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">flip_bit</span><span class="params">(<span class="keyword">unsigned</span> * x,</span></span></span><br><span class="line"><span class="function"><span class="params">              <span class="keyword">unsigned</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// YOUR CODE HERE</span></span><br><span class="line">    (*x) ^= (<span class="number">1</span> &lt;&lt; n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Exercise-2-Linear-feedback-shift-register"><a href="#Exercise-2-Linear-feedback-shift-register" class="headerlink" title="Exercise 2: Linear feedback shift register"></a>Exercise 2: Linear feedback shift register</h1><p>In this exercise, you will implement a lfsr_calculate() function to compute the next iteration of a linear feedback shift register (LFSR). Applications that use LFSRs are: Digital TV, CDMA cellphones, Ethernet, USB 3.0, and more! This function will generate pseudo-random numbers using bitwise operators. For some more background, read the Wikipedia article on Linear feedback shift registers. In lfsr.c, fill in the function lfsr_calculate() so that it does the following:</p>
<h2 id="Hardware-diagram-see-explanation-below"><a href="#Hardware-diagram-see-explanation-below" class="headerlink" title="Hardware diagram(see explanation below)"></a>Hardware diagram(see explanation below)</h2><img src="/2018/10/12/cs61c-lab02/LFSR-F16.gif" class="">

<h2 id="Explanation-of-the-above-diagram"><a href="#Explanation-of-the-above-diagram" class="headerlink" title="Explanation of the above diagram"></a>Explanation of the above diagram</h2><ul>
<li>On each call to lfsr_calculate, you will shift the contents of the register 1 bit to the right.</li>
<li>This shift is neither a logical shift or an arithmetic shift. On the left side, you will shift in a single bit equal to the Exclusive Or (XOR) of the bits originally in position 11, 13, 14, and 16.</li>
<li>The curved head-light shaped object is an XOR, which takes two inputs (a, b) and outputs a^b.</li>
<li>If you implemented lfsr_calculate() correctly, it should output all 65535 positive 16-bit integers before cycling back to the starting number.</li>
</ul>
<p>After you have correctly implemented lfsr_calculate(), compile lfsr and run it. Your output should be similar to the following:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">$ make lfsr</span><br><span class="line">$ .&#x2F;lfsr</span><br><span class="line">My number is: 1</span><br><span class="line">My number is: 5185</span><br><span class="line">My number is: 38801</span><br><span class="line">My number is: 52819</span><br><span class="line">My number is: 21116</span><br><span class="line">My number is: 54726</span><br><span class="line">My number is: 26552</span><br><span class="line">My number is: 46916</span><br><span class="line">My number is: 41728</span><br><span class="line">My number is: 26004</span><br><span class="line">My number is: 62850</span><br><span class="line">My number is: 40625</span><br><span class="line">My number is: 647</span><br><span class="line">My number is: 12837</span><br><span class="line">My number is: 7043</span><br><span class="line">My number is: 26003</span><br><span class="line">My number is: 35845</span><br><span class="line">My number is: 61398</span><br><span class="line">My number is: 42863</span><br><span class="line">My number is: 57133</span><br><span class="line">My number is: 59156</span><br><span class="line">My number is: 13312</span><br><span class="line">My number is: 16285</span><br><span class="line"> ... etc etc ...</span><br><span class="line">Got 65535 numbers before cycling!</span><br><span class="line">Congratulations! It works!</span><br></pre></td></tr></table></figure>

<p>Checkoff [2/3]</p>
<ul>
<li>Show how you implemented your lfsr_calculate function.</li>
<li>Show the output from running ./lfsr.</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">lfsr_calculate</span><span class="params">(<span class="keyword">uint16_t</span> *reg)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* YOUR CODE HERE */</span></span><br><span class="line">  <span class="keyword">uint16_t</span> <span class="built_in">bit</span> = ((*reg) &gt;&gt; <span class="number">0</span>) ^ ((*reg) &gt;&gt; <span class="number">2</span>) ^ ((*reg) &gt;&gt; <span class="number">3</span>) ^ ((*reg) &gt;&gt; <span class="number">5</span>);</span><br><span class="line">  *reg = (*reg &gt;&gt; <span class="number">1</span>) | (<span class="built_in">bit</span> &lt;&lt; <span class="number">15</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>I wrote the answer according to <a href="https://en.wikipedia.org/wiki/Linear-feedback_shift_register" target="_blank" rel="noopener">wiki</a></p>
<h1 id="Exercise-3-Memory-Management"><a href="#Exercise-3-Memory-Management" class="headerlink" title="Exercise 3: Memory Management"></a>Exercise 3: Memory Management</h1><p>This exercise uses vector.h, vector-test.c, and vector.c, where we provide you with a framework for implementing a variable-length array. This exercise is designed to help familiarize you with C structs and memory management in C.</p>
<p><strong>Your task is to explain why the two functions bad_vector_new() and also_bad_vector_new() are bad and fill in the functions vector_new(), vector_get(), vector_delete(), and vector_set() in vector.c so that our test code vector-test.c runs without any memory management errors.</strong> Comments in the code describe how the functions should work. Look at the functions we’ve filled in to see how the data structures should be used. For consistency, it is assumed that all entries in the vector are 0 unless set by the user. Keep this in mind as malloc() does not zero out the memory it allocates.</p>
<p>For explaining why the two bad functions are incorrect, keep in mind that one of these functions will actually run correctly (assuming correctly modified vector_new, vector_set, etc.) but there may be other problems; hint: think about memory usage.</p>
<h2 id="Using-Valgrind"><a href="#Using-Valgrind" class="headerlink" title="Using Valgrind"></a>Using Valgrind</h2><p>To help you to find memory bugs, we have installed a copy of Valgrind Memcheck. Valgrind is ONLY on the lab machines in the Hive and the Orchard. This program will run an executable while keeping track of what registers and regions of memory contain allocated and/or initialized values. The program will run much slower (by a factor of about 10 to 50) so that this information can be collected, but Valgrind Memcheck can identify many memory errors automatically at the point at which they are produced. You will need to learn the basics of how to parse the Valgrind output.</p>
<p>You can test your code in the following two ways:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 1) to check functionality:</span><br><span class="line">$ make vector-test</span><br><span class="line">$ ./vector-test</span><br><span class="line"></span><br><span class="line">// 2) to check memory management using Valgrind:</span><br><span class="line">$ make vector-memcheck</span><br></pre></td></tr></table></figure>
<p>The Makefile calls Valgrind as follows:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ valgrind --tool&#x3D;memcheck --leak-check&#x3D;full --track-origins&#x3D;yes [OS SPECIFIC ARGS] .&#x2F;&lt;executable&gt;</span><br></pre></td></tr></table></figure>
<p>The –track-origins flag attempts to identify the sources of unitialized values. The –leak-check=full option tries to identify memory leaks. [OS SPECIFIC ARGS] are simply a set of arguments to Valgrind that differ across operating systems (in our case, Ubuntu (Linux)). If you are interested in learning more about these, see the Makefile.</p>
<p>The last line in the Valgrind output is the line that will indicate at a glance if things have gone wrong. Here’s a sample output from a buggy program:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;&#x3D;47132&#x3D;&#x3D; ERROR SUMMARY: 1200039 errors from 24 contexts (suppressed: 18 from 18)</span><br></pre></td></tr></table></figure>
<p>If your program has errors, you can scroll up in the command line output to view details for each one. For our purposes, you can safely ignore all output that refers to suppressed errors. In a leak-free program, your output will look like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;&#x3D;44144&#x3D;&#x3D; ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 18 from 18)</span><br></pre></td></tr></table></figure>
<p>Again, any number of suppressed errors is fine; they do not affect us.</p>
<p>Feel free to also use a debugger or add printf statements to vector.c and vector-test.c to debug your code.</p>
<p>Checkoff [3/3]<br>Show your modifications to vector.c.<br>Show the output from running make vector-memcheck.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Bad example of how to create a new vector */</span></span><br><span class="line"><span class="comment">/* v is allocated in stack so when the function exits stack, the retval pointer may poinnt to garbage*/</span></span><br><span class="line"><span class="function"><span class="keyword">vector_t</span> *<span class="title">bad_vector_new</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="comment">/* Create the vector and a pointer to it */</span></span><br><span class="line">	<span class="keyword">vector_t</span> *retval, v;</span><br><span class="line">	retval = &amp;v;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Initialize attributes */</span></span><br><span class="line">	retval-&gt;<span class="built_in">size</span> = <span class="number">1</span>;</span><br><span class="line">	retval-&gt;data = <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">	<span class="keyword">if</span> (retval-&gt;data == <span class="literal">NULL</span>) &#123;</span><br><span class="line">		allocation_failed();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	retval-&gt;data[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">return</span> retval;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Another suboptimal way of creating a vector */</span></span><br><span class="line"><span class="comment">/* This is bad also because the v variable is allocated in stack. When function is returned ,the stack memory will be recycled.(Maybe I think) */</span></span><br><span class="line"><span class="function"><span class="keyword">vector_t</span> <span class="title">also_bad_vector_new</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="comment">/* Create the vector */</span></span><br><span class="line">	<span class="keyword">vector_t</span> v;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Initialize attributes */</span></span><br><span class="line">	v.<span class="built_in">size</span> = <span class="number">1</span>;</span><br><span class="line">	v.data = <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">	<span class="keyword">if</span> (v.data == <span class="literal">NULL</span>) &#123;</span><br><span class="line">		allocation_failed();</span><br><span class="line">	&#125;</span><br><span class="line">	v.data[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">return</span> v;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Create a new vector with a size (length) of 1</span></span><br><span class="line"><span class="comment">   and set its single component to zero... the</span></span><br><span class="line"><span class="comment">   RIGHT WAY */</span></span><br><span class="line"><span class="function"><span class="keyword">vector_t</span> *<span class="title">vector_new</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="comment">/* Declare what this function will return */</span></span><br><span class="line">	<span class="keyword">vector_t</span> *retval;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* First, we need to allocate memory on the heap for the struct */</span></span><br><span class="line">	retval = <span class="comment">/* YOUR CODE HERE */</span>(<span class="keyword">vector_t</span>*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">vector_t</span>));</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Check our return value to make sure we got memory */</span></span><br><span class="line">	<span class="keyword">if</span> (<span class="comment">/* YOUR CODE HERE */</span>retval == <span class="literal">NULL</span>) &#123;</span><br><span class="line">		allocation_failed();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Now we need to initialize our data.</span></span><br><span class="line"><span class="comment">	   Since retval-&gt;data should be able to dynamically grow,</span></span><br><span class="line"><span class="comment">	   what do you need to do? */</span></span><br><span class="line">	retval-&gt;<span class="built_in">size</span> = <span class="comment">/* YOUR CODE HERE */</span><span class="number">1</span>;</span><br><span class="line">	retval-&gt;data = <span class="comment">/* YOUR CODE HERE */</span>(<span class="keyword">int</span>*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Check the data attribute of our vector to make sure we got memory */</span></span><br><span class="line">	<span class="keyword">if</span> (<span class="comment">/* YOUR CODE HERE */</span>retval-&gt;data == <span class="literal">NULL</span>) &#123;</span><br><span class="line">		<span class="built_in">free</span>(retval);				<span class="comment">//Why is this line necessary?</span></span><br><span class="line">        allocation_failed();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Complete the initialization by setting the single component to zero */</span></span><br><span class="line">	<span class="comment">/* YOUR CODE HERE */</span>retval-&gt;data[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* and return... */</span></span><br><span class="line">	<span class="keyword">return</span> retval;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Return the value at the specified location/component "loc" of the vector */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">vector_get</span><span class="params">(<span class="keyword">vector_t</span> *v, <span class="keyword">size_t</span> loc)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* If we are passed a NULL pointer for our vector, complain about it and exit. */</span></span><br><span class="line">	<span class="keyword">if</span>(v == <span class="literal">NULL</span>) &#123;</span><br><span class="line">		<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"vector_get: passed a NULL vector.\n"</span>);</span><br><span class="line">        <span class="built_in">abort</span>();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* If the requested location is higher than we have allocated, return 0.</span></span><br><span class="line"><span class="comment">	 * Otherwise, return what is in the passed location.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (loc &lt; <span class="comment">/* YOUR CODE HERE */</span>v-&gt;<span class="built_in">size</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="comment">/* YOUR CODE HERE */</span>v-&gt;data[loc];</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Free up the memory allocated for the passed vector.</span></span><br><span class="line"><span class="comment">   Remember, you need to free up ALL the memory that was allocated. */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">vector_delete</span><span class="params">(<span class="keyword">vector_t</span> *v)</span> </span>&#123;</span><br><span class="line">	<span class="comment">/* YOUR SOLUTION HERE */</span></span><br><span class="line">	<span class="built_in">free</span>(v-&gt;data);</span><br><span class="line">	<span class="built_in">free</span>(v);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Set a value in the vector. If the extra memory allocation fails, call allocation_failed(). */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">vector_set</span><span class="params">(<span class="keyword">vector_t</span> *v, <span class="keyword">size_t</span> loc, <span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">	<span class="comment">/* What do you need to do if the location is greater than the size we have</span></span><br><span class="line"><span class="comment">	 * allocated?  Remember that unset locations should contain a value of 0.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/* YOUR SOLUTION HERE */</span></span><br><span class="line">	<span class="keyword">if</span> (loc &lt; v-&gt;<span class="built_in">size</span>) &#123;</span><br><span class="line">		v-&gt;data[loc] = value;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">int</span> *newdata = (<span class="keyword">int</span>*)<span class="built_in">realloc</span>(v-&gt;data, (loc + <span class="number">1</span>)*<span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">		<span class="keyword">int</span> i = v-&gt;<span class="built_in">size</span>;</span><br><span class="line">		<span class="keyword">if</span> (newdata == <span class="literal">NULL</span>) &#123;</span><br><span class="line">			allocation_failed();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// now v-&gt;data == NULL, v-&gt;size unchanged</span></span><br><span class="line">		<span class="keyword">while</span> (i &lt; loc) &#123;</span><br><span class="line">			newdata[i] = <span class="number">0</span>;</span><br><span class="line">			i++;</span><br><span class="line">		&#125;</span><br><span class="line">		newdata[loc] = value;</span><br><span class="line"></span><br><span class="line">		v-&gt;data = newdata;</span><br><span class="line">		v-&gt;<span class="built_in">size</span> = loc + <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Machine-Structure/" rel="tag"># Machine Structure</a>
              <a href="/tags/C/" rel="tag"># C</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2018/10/11/cs61c-disc02/" rel="prev" title="cs61c-disc02">
      <i class="fa fa-chevron-left"></i> cs61c-disc02
    </a></div>
      <div class="post-nav-item">
    <a href="/2018/10/13/cs61c-hw02/" rel="next" title="cs61c-hw02">
      cs61c-hw02 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Exercise-1-Bit-Operations"><span class="nav-number">1.</span> <span class="nav-text">Exercise 1: Bit Operations</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Exercise-2-Linear-feedback-shift-register"><span class="nav-number">2.</span> <span class="nav-text">Exercise 2: Linear feedback shift register</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Hardware-diagram-see-explanation-below"><span class="nav-number">2.1.</span> <span class="nav-text">Hardware diagram(see explanation below)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Explanation-of-the-above-diagram"><span class="nav-number">2.2.</span> <span class="nav-text">Explanation of the above diagram</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Exercise-3-Memory-Management"><span class="nav-number">3.</span> <span class="nav-text">Exercise 3: Memory Management</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Using-Valgrind"><span class="nav-number">3.1.</span> <span class="nav-text">Using Valgrind</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Guohang Ma</p>
  <div class="site-description" itemprop="description">developer blog</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">136</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">38</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Guohang Ma</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
